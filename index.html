<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WAITING</title>

<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<style>
body { font-family: Arial; text-align: center; }
img { width: 250px; margin-top: 20px; }
</style>
</head>

<body>

<h3>Teachable Machine</h3>
<img id="preview"/>

<script>
let model;

// send result to App Inventor
function sendToApp(msg) {
    if (window.AppInventor && window.AppInventor.setWebViewString) {
        window.AppInventor.setWebViewString(msg);
    }
    document.title = "RESULT:" + msg;
}

// load model
async function loadModel() {
    const modelURL = "https://pepalakrotiriou.github.io/potatocare/model/model.json";
    const metadataURL = "https://pepalakrotiriou.github.io/potatocare/model/metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    sendToApp("MODEL LOADED");
}

// receive IMAGE URL from App Inventor
window.fromAppInventor = async function(imageUrl) {
    const img = document.getElementById("preview");
    img.crossOrigin = "anonymous";
    img.src = imageUrl;

    img.onload = async () => {
        const prediction = await model.predict(img);

        let best = prediction.reduce((a,b)=>a.probability>b.probability?a:b);
        sendToApp(best.className + " " + (best.probability*100).toFixed(1) + "%");
    };
};

window.addEventListener("DOMContentLoaded", loadModel);
</script>

</body>
</html>
